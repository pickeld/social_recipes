{% extends "base.html" %}

{% block title %}Home - Social Recipes{% endblock %}

{% block content %}
<div class="main-container">
    <div class="header">
        <img src="{{ url_for('static', filename='icons/icon-128x128.png') }}" alt="Social Recipes" class="header-logo">
        <h1>Social Recipes</h1>
        <p>Extract recipes from TikTok, YouTube, Instagram and more</p>
    </div>
    
    <div class="url-input-section">
        <div class="input-group">
            <input type="url" id="video-url" placeholder="Paste video URL here (TikTok, YouTube, Instagram...)"
                   class="url-input" value="{{ shared_url or '' }}">
            <button id="process-btn" class="btn btn-primary">
                <i class="fas fa-magic"></i>
                Extract Recipe
            </button>
        </div>
        <p class="input-hint">You can start multiple extractions - up to 3 will process in parallel</p>
    </div>
    
    <!-- Active Jobs Section -->
    <div class="jobs-section" id="jobs-section" style="display: none;">
        <h2><i class="fas fa-tasks"></i> Active Jobs <span class="job-count" id="job-count">(0)</span></h2>
        <div class="jobs-list" id="jobs-list">
            <!-- Job cards will be dynamically inserted here -->
        </div>
    </div>
    
    <!-- Completed Results Section (for recent completions) -->
    <div class="result-section" id="result-section" style="display: none;">
        <h2><i class="fas fa-check-circle"></i> Recently Completed</h2>
        <div class="completed-recipes" id="completed-recipes"></div>
        <a href="{{ url_for('history') }}" class="btn btn-secondary">
            <i class="fas fa-history"></i>
            View All History
        </a>
    </div>
</div>

<!-- Job Card Template (hidden, used for cloning) -->
<template id="job-card-template">
    <div class="job-card" data-job-id="">
        <div class="job-header">
            <div class="job-info">
                <h3 class="job-title">Processing video...</h3>
                <p class="job-url"></p>
            </div>
            <button class="btn btn-icon cancel-job-btn" title="Cancel">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="job-progress">
            <div class="progress-bar-container">
                <div class="progress-bar" style="width: 0%"></div>
                <span class="progress-text">0%</span>
            </div>
        </div>
        
        <div class="job-steps">
            <div class="job-step" data-stage="info">
                <i class="fas fa-info-circle"></i>
            </div>
            <div class="job-step" data-stage="download">
                <i class="fas fa-download"></i>
            </div>
            <div class="job-step" data-stage="transcribe">
                <i class="fas fa-microphone"></i>
            </div>
            <div class="job-step" data-stage="visual">
                <i class="fas fa-eye"></i>
            </div>
            <div class="job-step" data-stage="image">
                <i class="fas fa-image"></i>
            </div>
            <div class="job-step" data-stage="evaluate">
                <i class="fas fa-robot"></i>
            </div>
            <div class="job-step" data-stage="upload">
                <i class="fas fa-cloud-upload-alt"></i>
            </div>
        </div>
        
        <div class="job-message">
            <span class="message-text">Waiting to start...</span>
        </div>
    </div>
</template>

<!-- Completed Recipe Card Template -->
<template id="completed-card-template">
    <div class="completed-card" data-job-id="">
        <div class="completed-icon success">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="completed-info">
            <h4 class="completed-title">Recipe Name</h4>
            <p class="completed-message">Uploaded successfully!</p>
        </div>
        <a href="#" class="btn btn-secondary view-history-btn">View</a>
    </div>
</template>
{% endblock %}

{% block modals %}
<!-- Recipe Preview Modal -->
<div class="modal-overlay" id="preview-modal" style="display: none;">
    <div class="modal-container">
        <div class="modal-header">
            <h2><i class="fas fa-eye"></i> Recipe Preview</h2>
            <p class="modal-subtitle">Review before uploading to <span id="preview-target"></span></p>
        </div>
        
        <div class="modal-body">
            <div class="preview-image-section">
                <h4><i class="fas fa-image"></i> Select Dish Photo</h4>
                <p class="image-selection-hint">Click to select the best photo for your recipe (AI recommendation marked with <i class="fas fa-star"></i>)</p>
                
                <div class="preview-image-container" id="preview-image-container" style="display: none;">
                    <img id="preview-image" src="" alt="Selected dish photo">
                </div>
                
                <div class="image-candidates-grid" id="image-candidates-grid"></div>
            </div>
            
            <div class="preview-content">
                <h3 id="preview-title"></h3>
                <p id="preview-description"></p>
                
                <div class="preview-section">
                    <h4><i class="fas fa-list"></i> Ingredients</h4>
                    <ul id="preview-ingredients"></ul>
                </div>
                
                <div class="preview-section">
                    <h4><i class="fas fa-tasks"></i> Instructions</h4>
                    <ol id="preview-instructions"></ol>
                </div>
            </div>
        </div>
        
        <div class="modal-footer">
            <button id="cancel-upload-btn" class="btn btn-secondary">
                <i class="fas fa-times"></i>
                Cancel
            </button>
            <button id="confirm-upload-btn" class="btn btn-primary">
                <i class="fas fa-cloud-upload-alt"></i>
                Confirm Upload
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/main.js') }}?v=3"></script>
{% endblock %}
